<!--pages/search/search.wxml-->

<wxs module='tools' src='../../WXS/tools.wxs'></wxs>
<wxs src="../../WXS/subutil_content.wxs" module="content_tools" />
<wxs src="../../WXS/subutil_title.wxs" module="title_tools" />
<wxs src="../../WXS/subutil_title_long.wxs" module="title_tools_long" />
<wxs src="../../WXS/subutil_name.wxs" module="name_tools" />
<wxs src="../../WXS/subutil_radioToCate.wxs" module="radioToCate" />
<wxs module = "getDate" src="../../WXS/sub_date.wxs"></wxs>
<van-toast id="van-toast" />

<view id="stories-list" >
        <block wx:for="{{ tasks }}" wx:key="index" wx:for-item="task" >
          <view>
            <van-row >
              <van-col span="3" offset="0" custom-class="avatar-box" ><image class="avatar" src="{{ task.avatar }}" mode="aspectFit" ></image></van-col>
              <van-col span="21">
                <van-row gutter="20" custom-class="row1" >
                  <van-col span="8" custom-class="userName" data-id="{{ task.id }}" bindtap="goToStoryDetail" >{{ name_tools.sub(task.userName)}}</van-col>
                  <van-col span="10" custom-class="c_time" data-id="{{ task.id }}" bindtap="goToStoryDetail" >{{getDate.getGap(task.c_time)}}</van-col>
                  <van-col span="2" custom-class="ellipsis">
                    <!-- <van-icon name="ellipsis"/> -->
                    <van-dropdown-menu overlay="false" custom-class="collapse-box">
                      <van-dropdown-item id="item" title="{{ itemTitle }}" custom-class="collapse-item">
                          <van-row>
                            <van-col span="24" ><van-button type="default" mini open-type="share">分享</van-button></van-col>
                          </van-row>
                          <van-row>
                            <van-col span="24" ><van-button type="default" mini bind:click="sendMsg">私信</van-button></van-col>
                          </van-row>
                          <van-row>
                            <van-col span="24" ><van-button type="default" mini bind:click="toSuggestion" >举报</van-button></van-col>
                          </van-row>
                      </van-dropdown-item>
                    </van-dropdown-menu>
                  </van-col>
                </van-row>
                <van-row gutter="20" data-id="{{ task.id }}" bindtap="goToStoryDetail">
                  <van-col span="21" custom-class="title" >{{ title_tools_long.sub(task.title)}}</van-col>
                </van-row>
                <van-row gutter="20" wx:if="{{ task.img[0] }}" data-id="{{ task.id }}" bindtap="goToStoryDetail">
                  <van-col span="8"><image class="task-img" src='{{ task.img[0]+"?imageView2/2/w/200" }}' mode='widthFix' data-id="{{ task.id }}"></image></van-col>
                </van-row>
                <van-row gutter="20" custom-class="action">
                  <van-col span="8" custom-class="tag" data-id="{{ task.id }}" bindtap="goToStoryDetail"><van-tag mark type="success" >{{radioToCate.radioToCate(task.radioGroup)}}</van-tag></van-col>
                  <van-col span="8" custom-class="like" bindtap='thumbsup' data-id="{{ task.id }}" data-index="{{ index }}" wx:if="{{ task.state }}">
                    <van-icon name="like" />Like<text wx:if="{{ task.likeNum!=0 }}">({{ task.likeNum }})</text>
                  </van-col>
                  <van-col span="8" custom-class="like" bindtap='thumbsup' data-id="{{ task.id }}" data-index="{{ index }}" wx:else>
                    <van-icon name="like-o" />Like<text wx:if="{{ task.likeNum!=0 }}">({{ task.likeNum }})</text>
                  </van-col>
                  <van-col span="8" custom-class="comment" data-id="{{ task.id }}" bindtap="goToStoryDetail">
                    <van-icon name="chat-o" />评论<text wx:if="{{ task.commentNum!=0 }}">({{ task.commentNum }})</text>
                  </van-col>
                </van-row>
              </van-col>
            </van-row>
          </view>    
          <van-divider />
        </block>
      </view> 